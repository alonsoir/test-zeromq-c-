docs: Update CLAUDE.md with Day 53 plan - HMAC log security

SUMMARY
=======
Updated technical reference (CLAUDE.md) with Day 52 achievements and
comprehensive Day 53 plan for implementing HMAC-based log integrity
to prevent log poisoning attacks against the RAG system.

CHANGES
=======

1. Day 52 Status Updates
   -------------------------
   - Marked firewall-acl-agent as "Production-Ready" âœ…
   - Added stress testing results (36K events, 0 errors)
   - Updated known issues (resolved hardcoding bugs)
   - Added capacity planning section
   - Updated Via Appia principles (Graceful Degradation)

2. NEW: RAG Log Security Section
   --------------------------------
   - Documented log poisoning threat model
   - Explained why HMAC > ChaCha20 for RAG logs
   - Detailed HMAC implementation architecture
   - Added security guarantees and benefits
   - Included key management strategy
   - Defense-in-depth measures

3. Day 53 Implementation Plan
   ----------------------------
   - Phase 1: Audit ml-detector + rag-ingester current state
   - Phase 2: Implement HMAC in firewall-acl-agent â†’ rag-ingester
   - Phase 3: Implement HMAC in ml-detector â†’ rag-ingester
   - Acceptance criteria and testing strategy
   - Performance targets (<5Î¼s overhead)

4. Updated Anti-Patterns
   -----------------------
   - DO NOT: Encrypt RAG logs with ChaCha20 (use HMAC for integrity)
   - DO NOT: Write RAG logs without integrity protection
   - DO: Protect RAG logs with HMAC (detect tampering)

SECURITY RATIONALE
==================

Log Poisoning Attacks:
  - Attacker injects malicious content â†’ contaminates RAG
  - Attacker modifies logs â†’ hides activity
  - Attacker poisons ML training data â†’ degrades accuracy
  - Attacker manipulates LLM responses â†’ arbitrary behavior

Why HMAC vs ChaCha20 for RAG Logs:

| Feature              | ChaCha20 | HMAC |
|----------------------|----------|------|
| FAISS indexing       | âŒ       | âœ…   |
| Detect tampering     | âŒ       | âœ…   |
| Detect injection     | âŒ       | âœ…   |
| Performance          | 10Î¼s     | 2Î¼s  |
| Logs human-readable  | âŒ       | âœ…   |
| Key compromise risk  | High     | Low  |

Conclusion: HMAC provides integrity + FAISS compatibility.

ARCHITECTURE
============

Secure Logging Flow (Day 53):

  Component (ml-detector / firewall-acl-agent)
    â”œâ”€ Generate log line (plaintext)
    â”œâ”€ Retrieve HMAC key from etcd
    â”œâ”€ Compute HMAC-SHA256(log_line, hmac_key)
    â””â”€ Write: "log_line|HMAC:hex_value\n"

  rag-ingester
    â”œâ”€ Read log file (permissions: 0400)
    â”œâ”€ For each line:
    â”‚   â”œâ”€ Split â†’ (message, hmac_hex)
    â”‚   â”œâ”€ Compute expected_hmac
    â”‚   â”œâ”€ Constant-time compare
    â”‚   â”œâ”€ If VALID â†’ parse and ingest
    â”‚   â””â”€ If INVALID â†’ REJECT + ALERT
    â””â”€ Metrics: tampering_attempts_total

  RAG / FAISS
    â”œâ”€ Contains ONLY validated logs
    â””â”€ Protected against log poisoning âœ…

DOCUMENTATION ADDITIONS
=======================

New Sections:
  - RAG Log Security (comprehensive threat model)
  - HMAC vs Encryption comparison table
  - Implementation plan (3 phases)
  - Security guarantees after Day 53
  - Key management strategy
  - Defense-in-depth measures

Updated Sections:
  - Development Phase & Current State
  - Known Issues (Day 52 resolved, Day 53 planned)
  - Anti-Patterns & Lessons Learned
  - Via Appia Quality Principles
  - Footer (status update)

FILES MODIFIED
==============
- CLAUDE.md (technical reference)

FILES CREATED
=============
- docs/day53_continuity_prompt.md (implementation guide)

VALIDATION
==========
Day 52 achievements documented:
  âœ… Config-driven architecture (no hardcoding)
  âœ… Stress testing (36K events, 0 crypto errors)
  âœ… Graceful degradation validated
  âœ… IPSet capacity planning insights

Day 53 plan documented:
  âœ… Threat model (log poisoning)
  âœ… Solution architecture (HMAC)
  âœ… Implementation phases (audit â†’ firewall â†’ ml-detector)
  âœ… Security guarantees
  âœ… Testing strategy

NEXT SESSION (Day 53)
=====================
1. Audit ml-detector + rag-ingester current implementation
2. Create feature branch: feature/rag-firewall-hmac-security
3. Implement HMAC in firewall-acl-agent
4. Implement HMAC validation in rag-ingester
5. Test tampering detection (inject malicious lines)
6. Verify: valid logs pass, invalid logs rejected with alerts

VIA APPIA QUALITY
=================
"Security is not an afterthought. Log integrity must be built in from
the foundation, like the stones of the Via Appia, each one verified
before being laid." ðŸ›ï¸

Prevention > Detection > Response
HMAC ensures prevention at the source.

Co-authored-by: Claude (Anthropic)