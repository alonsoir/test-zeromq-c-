{
  "_header": "C++20 SNIFFER v3.3.1 - Day 8 Dual-NIC Testing Configuration",
  "_refactor_notes": {
    "date": "2025-12-02",
    "changes": [
      "v3.2 (2025-10-28): Removed duplicate capture.interface fields, centralized in profiles",
      "v3.3 (2025-12-01): Added dual-NIC deployment support for host-based + gateway modes",
      "v3.3.1 (2025-12-02): Adapted for Day 8 testing - eth1 (WAN) + eth3 (LAN) mapping"
    ]
  },
  "component": {
    "name": "cpp_evolutionary_sniffer",
    "version": "3.3.1",
    "mode": "kernel_user_hybrid",
    "kernel_version_required": "6.1.0"
  },

  "deployment": {
    "_comment": "Dual-NIC deployment configuration - Phase 1, Day 8 Testing",
    "_architecture": "Host-based IDS (WAN eth1) + Gateway IDS (LAN eth3) simultaneous operation",
    "_vagrant_mapping": "eth0=NAT, eth1=192.168.56.20 (WAN), eth2=bridge, eth3=192.168.100.1 (LAN)",

    "mode": "dual",
    "_mode_options": [
      "host-only",
      "gateway-only",
      "dual",
      "validation"
    ],
    "_mode_descriptions": {
      "host-only": "Single NIC - protects only this host (bastion defense)",
      "gateway-only": "Single NIC - inspects transit traffic (router mode)",
      "dual": "Dual NIC - simultaneous host protection + gateway inspection",
      "validation": "Testing mode - libpcap replay support for PCAP validation"
    },

    "host_interface": {
      "name": "eth1",
      "role": "wan",
      "mode": "host-based",
      "description": "WAN-facing interface (192.168.56.20) - protects the host from OSX attacks",
      "xdp_mode": "native",
      "promiscuous": true,
      "capture_direction": "ingress_only",
      "_behavior": "Captures packets DESTINED to this host (interface_mode=1)",
      "_day8_test": "Attack from OSX: nmap, hping3 â†’ 192.168.56.20"
    },

    "gateway_interface": {
      "name": "eth3",
      "role": "lan",
      "mode": "gateway",
      "description": "LAN-facing interface (192.168.100.1) - inspects transit traffic",
      "xdp_mode": "native",
      "promiscuous": true,
      "capture_direction": "bidirectional",
      "_behavior": "Captures ALL transit traffic passing through (interface_mode=2)",
      "_day8_test": "PCAP replay: tcpreplay -i eth3 --mbps 100 dataset.pcap"
    },

    "network_settings": {
      "enable_ip_forwarding": true,
      "enable_nat": false,
      "_nat_note": "NAT disabled for Day 8 testing - pure inspection mode",
      "enable_bridge_mode": false,
      "mtu": 1500,
      "txqueuelen": 10000
    },

    "performance": {
      "expected_throughput_gbps": 1.0,
      "max_pps_per_interface": 1000000,
      "target_latency_us": 100,
      "buffer_tuning": {
        "rx_ring_size": 4096,
        "tx_ring_size": 4096
      }
    },

    "detection": {
      "differentiate_by_interface": true,
      "tag_events_with_source": true,
      "interface_specific_thresholds": false,
      "_future": "Potential for different thresholds WAN vs LAN"
    },

    "hardware_requirements": {
      "_minimum_testing": {
        "cpu_cores": 4,
        "cpu_freq_ghz": 2.0,
        "ram_gb": 8,
        "nic": "Dual 1GbE (Intel i350 recommended)",
        "example": "Intel NUC, x86 Mini PC"
      },
      "_recommended_production": {
        "cpu_cores": 8,
        "cpu_freq_ghz": 3.0,
        "ram_gb": 16,
        "nic": "Dual 10GbE (Intel X710, Mellanox ConnectX-5)",
        "example": "Supermicro 1U, Dell PowerEdge R240"
      },
      "_reality_check": {
        "raspberry_pi_5": "~100 Mbps (insufficient for 1Gbps)",
        "raspberry_pi_cm4_dual_nic": "~500 Mbps (marginal)",
        "x86_n100_mini_pc": "~1 Gbps (sweet spot for SMB)"
      }
    },

    "validation_mode": {
      "enabled": false,
      "libpcap_replay": true,
      "pcap_source_interface": "eth2",
      "accept_any_dst_ip": true,
      "_use_case": "For PCAP replay testing (MAWI, CTU-13, etc) via bridge interface"
    }
  },

  "node_id": "cpp_sniffer_v33_day8",
  "cluster_name": "ml-defender-dual-nic-test",

  "profiles": {
    "lab": {
      "capture_interface": "eth1",
      "promiscuous_mode": true,
      "af_xdp_enabled": true,
      "worker_threads": 2,
      "compression_level": 1,
      "_note": "Day 8 testing profile - eth1 (WAN-facing)"
    },
    "cloud": {
      "capture_interface": "eth0",
      "promiscuous_mode": false,
      "af_xdp_enabled": true,
      "worker_threads": 8,
      "compression_level": 3
    },
    "bare_metal": {
      "capture_interface": "eth0",
      "promiscuous_mode": true,
      "af_xdp_enabled": true,
      "worker_threads": 16,
      "compression_level": 1,
      "cpu_affinity_enabled": true
    },
    "dual_nic": {
      "_new": "Phase 1, Day 8 - Dual-NIC testing profile",
      "capture_interface": "eth1",
      "_note": "Primary WAN interface eth1, gateway eth3 configured via deployment section",
      "promiscuous_mode": true,
      "af_xdp_enabled": true,
      "worker_threads": 6,
      "compression_level": 1,
      "cpu_affinity_enabled": false,
      "_day8_config": "6 workers for dual-NIC load (8GB RAM, 6 cores available)"
    }
  },

  "profile": "dual_nic",

  "capture": {
    "mode": "ebpf_skb",
    "xdp_flags": [
      "XDP_FLAGS_UPDATE_IF_NOEXIST"
    ],
    "promiscuous_mode": true,

    "_comment_filter": "Hybrid filtering system v3.2 - Dynamic BPF Maps",
    "filter": {
      "version": "1.0",
      "mode": "hybrid",
      "excluded_ports": [22],
      "included_ports": [],
      "default_action": "capture"
    },

    "buffer_size": 65536,
    "min_packet_size": 20,
    "max_packet_size": 65536,
    "included_protocols": [
      "tcp",
      "udp",
      "icmp"
    ],
    "af_xdp": {
      "enabled": false,
      "queue_id": 0,
      "frame_size": 2048,
      "fill_ring_size": 2048,
      "comp_ring_size": 2048,
      "tx_ring_size": 2048,
      "rx_ring_size": 2048,
      "umem_size": 16777216
    }
  },

  "buffers": {
    "ring_buffer_entries": 65536,
    "user_processing_queue_depth": 300,
    "protobuf_serialize_buffer_size": 65536,
    "zmq_send_buffer_size": 262144,
    "flow_state_buffer_entries": 500000,
    "statistics_buffer_entries": 10000,
    "batch_processing_size": 4
  },

  "threading": {
    "ring_consumer_threads": 1,
    "feature_processor_threads": 1,
    "zmq_sender_threads": 1,
    "statistics_collector_threads": 1,
    "total_worker_threads": 4,
    "cpu_affinity": {
      "enabled": false,
      "ring_consumers": [0, 1],
      "processors": [2, 3, 4, 5],
      "zmq_senders": [6, 7],
      "statistics": [8]
    },
    "thread_priorities": {
      "ring_consumers": "high",
      "processors": "normal",
      "zmq_senders": "normal"
    }
  },

  "kernel_space": {
    "ebpf_program": "sniffer.bpf.o",
    "xdp_mode": "skb",
    "ring_buffer_size": 1048576,
    "max_flows_in_kernel": 500000,
    "flow_timeout_seconds": 300,
    "kernel_features": [
      "source_ip",
      "destination_ip",
      "source_port",
      "destination_port",
      "protocol_number",
      "total_forward_packets",
      "total_backward_packets",
      "total_forward_bytes",
      "total_backward_bytes",
      "fin_flag_count",
      "syn_flag_count",
      "rst_flag_count",
      "psh_flag_count",
      "ack_flag_count",
      "urg_flag_count"
    ],
    "performance": {
      "cpu_budget_us_per_packet": 50,
      "max_instructions_per_program": 1000000,
      "map_update_batch_size": 100
    }
  },

  "user_space": {
    "flow_table_size": 1000000,
    "time_window_buffer_size": 10000,
    "user_features": [
      "ddos_feature_group",
      "ransomware_feature_group",
      "rf_feature_group",
      "internal_traffic_feature_group"
    ],
    "memory_management": {
      "flow_eviction_policy": "lru",
      "max_memory_usage_mb": 2048,
      "gc_interval_seconds": 60
    }
  },

  "feature_groups": {
    "ddos_feature_group": {
      "count": 83,
      "reference": "config/features/ddos_83_features.json",
      "description": "DDOS detection features including packet rates, flag patterns, timing analysis"
    },
    "ransomware_feature_group": {
      "count": 20,
      "reference": "config/features/ransomware_20_features.json",
      "description": "Ransomware detection features (20 critical features optimized for RPi)"
    },
    "rf_feature_group": {
      "count": 23,
      "reference": "config/features/rf_23_features.json",
      "description": "Random Forest general attack detection (Level 1)"
    },
    "internal_traffic_feature_group": {
      "count": 4,
      "reference": "config/features/internal_4_features.json",
      "description": "Internal traffic classification features"
    }
  },

  "sniffer_time_windows": {
    "flow_tracking_window_seconds": 300,
    "statistics_collection_window_seconds": 60,
    "feature_aggregation_window_seconds": 30,
    "cleanup_interval_seconds": 30,
    "max_flows_per_window": 100000,
    "window_overlap_seconds": 10
  },

  "network": {
    "output_socket": {
      "address": "127.0.0.1",
      "port": 5571,
      "mode": "bind",
      "socket_type": "PUSH",
      "high_water_mark": 1000
    }
  },

  "zmq": {
    "worker_threads": 1,
    "io_thread_pools": 1,
    "socket_pools": {
      "push_sockets": 1,
      "load_balancing": "round_robin",
      "failover_enabled": true
    },
    "queue_management": {
      "internal_queues": 2,
      "queue_size": 300,
      "queue_timeout_ms": 100,
      "overflow_policy": "drop_oldest"
    },
    "connection_settings": {
      "sndhwm": 10000,
      "linger_ms": 100,
      "send_timeout_ms": 250,
      "rcvhwm": 10000,
      "recv_timeout_ms": 500,
      "tcp_keepalive": 1,
      "sndbuf": 2621440,
      "rcvbuf": 2621440,
      "reconnect_interval_ms": 1000,
      "max_reconnect_attempts": 10
    },
    "batch_processing": {
      "enabled": false,
      "batch_size": 50,
      "batch_timeout_ms": 10,
      "max_batches_queued": 100
    }
  },

  "transport": {
    "compression": {
      "enabled": false,
      "algorithm": "lz4",
      "level": 1,
      "min_compress_size": 0,
      "compression_ratio_threshold": 0.8,
      "adaptive_compression": false
    },
    "encryption": {
      "enabled": false,
      "etcd_token_required": true,
      "algorithm": "chacha20-poly1305",
      "key_size": 256,
      "key_rotation_hours": 24,
      "fallback_mode": "compression_only",
      "zmq_curve_enabled": true,
      "curve_server_key": null,
      "curve_secret_key": null
    }
  },

  "etcd": {
    "enabled": false,
    "endpoints": ["localhost:2379"],
    "connection_timeout_ms": 5000,
    "retry_attempts": 3,
    "retry_interval_ms": 1000,
    "crypto_token_path": "/crypto/sniffer/tokens",
    "config_sync_path": "/config/sniffer",
    "required_for_encryption": true,
    "fallback_mode": "standalone_unencrypted",
    "heartbeat_interval_seconds": 30,
    "lease_ttl_seconds": 60
  },

  "processing": {
    "kernel_processing": {
      "max_map_entries": 1000000,
      "flow_hash_table_size": 1000000,
      "counter_map_size": 100000,
      "stats_collection_interval_ms": 1000
    },
    "user_processing": {
      "internal_queue_size": 10000,
      "queue_timeout_seconds": 1,
      "batch_size": 100,
      "lockfree_queues": true,
      "numa_aware_allocation": true,
      "memory_prefaulting": true
    },
    "feature_extraction": {
      "enabled": false,
      "extract_all_features": true,
      "cache_flow_states": true,
      "flow_timeout_seconds": 300,
      "max_concurrent_flows": 1000000,
      "statistics_engine": "high_performance_cpp",
      "simd_optimization": true
    }
  },

  "auto_tuner": {
    "enabled": false,
    "calibration_on_startup": true,
    "benchmark_iterations": 100000,
    "recalibration_interval_hours": 24,
    "safety_margin_factor": 1.2,
    "feature_placement_strategy": "cost_benefit_optimization"
  },

  "monitoring": {
    "stats_interval_seconds": 30,
    "performance_tracking": true,
    "kernel_metrics": {
      "ebpf_program_stats": true,
      "map_utilization": true,
      "instruction_count": true,
      "processing_time_per_packet": true
    },
    "user_metrics": {
      "feature_extraction_rate": true,
      "queue_depth": true,
      "memory_usage": true,
      "thread_utilization": true,
      "compression_ratio": true,
      "zmq_throughput": true
    },
    "alerts": {
      "max_drop_rate_percent": 1,
      "max_queue_usage_percent": 85,
      "max_memory_usage_mb": 4096,
      "max_cpu_usage_percent": 80,
      "max_processing_latency_us": 100,
      "min_compression_ratio": 0.3
    }
  },

  "logging": {
    "level": "INFO",
    "file": "/vagrant/logs/lab/sniffer.log",
    "max_file_size_mb": 200,
    "backup_count": 10,
    "include_performance_logs": true,
    "include_compression_stats": true,
    "include_thread_stats": true,
    "_day8_note": "Logs to /vagrant/logs/lab/ for easy access from host OSX"
  },

  "protobuf": {
    "schema_version": "v3.1.0",
    "validate_before_send": true,
    "max_event_size_bytes": 100000,
    "serialization_timeout_ms": 50,
    "pool_size": 1000,
    "reuse_objects": true
  },

  "security": {
    "input_validation": {
      "enabled": false,
      "max_packet_size_bytes": 65536,
      "validate_ip_addresses": true,
      "validate_ports": true,
      "sanitize_inputs": true
    }
  },

  "backpressure": {
    "enabled": false,
    "kernel_backpressure": {
      "ring_buffer_full_action": "drop_oldest"
    },
    "user_backpressure": {
      "max_drops_per_second": 1000,
      "adaptive_rate_limiting": true
    },
    "circuit_breaker": {
      "enabled": false,
      "failure_threshold": 50,
      "recovery_timeout": 30
    }
  },

  "ml_defender": {
    "_comment": "ML Defender Embedded C++20 Detectors - Day 8 Conservative Thresholds",
    "_source": "Single source of truth for detection thresholds",
    "_calibration": "Conservative values for initial dual-NIC validation",
    "_day8_tuning": "After 2+ hour stress test, adjust based on false positive rate",
    "thresholds": {
      "ddos": 0.85,
      "ransomware": 0.90,
      "traffic": 0.80,
      "internal": 0.85
    },
    "validation": {
      "min_threshold": 0.5,
      "max_threshold": 0.99,
      "fallback_threshold": 0.75
    }
  }
}